<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AstracatGen v1</title>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      #loading-spinner {
        display: none;
      }
      .progress-bar {
        height: 4px;
        background: linear-gradient(to right, #6366f1, #9333ea);
        animation: loading 2s linear infinite;
      }
      @keyframes loading {
        0% { width: 0%; }
        50% { width: 50%; }
        100% { width: 100%; }
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-black via-gray-900 to-black text-white min-h-screen flex flex-col items-center justify-center p-4 font-mono">
    <div class="w-full max-w-2xl bg-zinc-900 border border-zinc-700 rounded-xl shadow-2xl p-8">
      <div class="flex justify-center mb-4">
        <h1 class="text-4xl font-extrabold text-indigo-400 tracking-wide flex items-center gap-2">
          üê± AstracatGen <span class="text-sm text-gray-500">v1</span>
        </h1>
      </div>

      <div class="cf-turnstile mb-5" data-sitekey="0x4AAAAAABLgaFLEZGcqAM3Q"></div>

      <label class="block text-sm mb-1 text-gray-400">–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏:</label>
      <select id="model-select" class="w-full p-2 mb-4 rounded-md bg-zinc-800 text-white border border-zinc-700">
        <option value="Xenova/gpt2">GPT2 (117M)</option>
        <option value="Xenova/distil-gpt2">Distil-GPT2 (–º–µ–Ω—å—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ)</option>
      </select>

      <label class="block text-sm mb-1 text-gray-400">–í–æ–ø—Ä–æ—Å:</label>
      <input
        type="text"
        id="user-input"
        placeholder="–°–ø—Ä–∞—à–∏–≤–∞–π –≤—Å—ë –ø–æ –≤–µ–±-–∫–æ–¥–∏–Ω–≥—É..."
        class="w-full p-4 rounded-md bg-zinc-800 text-white mb-4 border border-zinc-700 focus:outline-none focus:ring-2 focus:ring-indigo-600"
      />
      <button
        id="send-button"
        class="w-full bg-indigo-700 hover:bg-indigo-800 active:bg-indigo-900 transition-all text-white py-3 rounded-md font-bold tracking-wide"
        disabled
      >
        –û—Ç–≤–µ—Ç–∏—Ç—å
      </button>
      <div id="loading-spinner" class="mt-4 text-center text-sm text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ AstracatGen...</div>
      <div id="progress-bar" class="progress-bar mt-2 rounded-lg hidden"></div>
      <pre id="response" class="mt-6 whitespace-pre-wrap bg-zinc-950 p-4 rounded-lg text-green-400 font-mono border border-zinc-800"></pre>
    </div>
    <footer class="mt-6 text-gray-600 text-sm text-center">
      AstracatGen v1 ‚Ä¢ GPT2 –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ API ‚Ä¢ –°–¥–µ–ª–∞–Ω–æ —Å ‚ô•Ô∏è –∏ –±—Ä—É—Ç–∞–ª—å–Ω–æ—Å—Ç—å—é
    </footer>

    <script>
      let pipeline;

      const loadModel = async (modelName) => {
        const spinner = document.getElementById("loading-spinner");
        const button = document.getElementById("send-button");
        const output = document.getElementById("response");
        const progressBar = document.getElementById("progress-bar");

        spinner.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ ${modelName}...`;
        spinner.style.display = "block";
        progressBar.classList.remove("hidden");
        button.disabled = true;
        output.textContent = "";

        try {
          const env = window.transformers.env;
          env.allowLocalModels = false;
          env.allowRemoteModels = true;
          env.backends.onnx.wasm.numThreads = 1;

          pipeline = await window.transformers.pipeline("text-generation", modelName);

          spinner.style.display = "none";
          progressBar.classList.add("hidden");
          button.disabled = false;
        } catch (err) {
          spinner.textContent = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: ${err.message}`;
          progressBar.classList.add("hidden");
          console.error(err);

          // fallback –Ω–∞ distil-gpt2
          if (modelName !== "Xenova/distil-gpt2") {
            spinner.textContent += "\n‚è≥ –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å Distil-GPT2...";
            await loadModel("Xenova/distil-gpt2");
            document.getElementById("model-select").value = "Xenova/distil-gpt2";
          }
        }
      };

      const initializeApp = async () => {
        const script = document.createElement("script");
        script.src = "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.4.1/dist/transformers.min.js";

        script.onload = async () => {
          const modelSelect = document.getElementById("model-select");
          await loadModel(modelSelect.value);

          modelSelect.addEventListener("change", async () => {
            await loadModel(modelSelect.value);
          });

          const button = document.getElementById("send-button");
          const input = document.getElementById("user-input");
          const output = document.getElementById("response");

          button.addEventListener("click", async () => {
            output.textContent = "AstracatGen –¥—É–º–∞–µ—Ç...";
            const text = input.value;
            const result = await pipeline(text, { max_new_tokens: 50 });
            output.textContent = result[0].generated_text;
          });
        };

        script.onerror = () => {
          document.getElementById("loading-spinner").textContent = "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AstracatGen.";
        };

        document.body.appendChild(script);
      };

      window.onload = initializeApp;
    </script>
  </body>
</html>
